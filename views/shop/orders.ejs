<%- include('../includes/head.ejs') %>
</head>

<body>
  <%- include('../includes/navigation.ejs') %>

  <main>
    <h1>Your Orders</h1>

    <% if (!orders || orders.length === 0) { %>
      <h2>No orders yet.</h2>
    <% } else { %>

      <% orders.forEach(o => { %>
        <section class="card">
          <div class="card__content">
            <h2>Order #<%= o.order.id %></h2>
            <p>
              Date:
              <%= new Date(o.order.createdAt).toLocaleString() %>
            </p>

            <% if (!o.products || o.products.length === 0) { %>
              <p>No products in this order.</p>
            <% } else { %>
              <ul>
                <% o.products.forEach(p => { %>
                  <li>
                    <strong><%= p.title %></strong>
                    — Qty: <%= p.orderItem.quantity %>
                    — Price: $<%= p.price %>
                    — Line total: $<%= p.orderItem.quantity * p.price %>
                  </li>
                <% }) %>
              </ul>

              <p>
                <strong>
                  Order total: $
                  <%= o.products.reduce((sum, p) => sum + (p.orderItem.quantity * p.price), 0) %>
                </strong>
              </p>
            <% } %>
          </div>
        </section>
      <% }) %>

    <% } %>
  </main>

<%- include('../includes/end.ejs') %>
